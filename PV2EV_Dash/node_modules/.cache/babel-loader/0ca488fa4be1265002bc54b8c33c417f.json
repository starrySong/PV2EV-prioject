{"ast":null,"code":"import _createForOfIteratorHelper from \"C:\\\\Users\\\\songt\\\\PycharmProjects\\\\PV2EV_Dash\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"C:\\\\Users\\\\songt\\\\PycharmProjects\\\\PV2EV_Dash\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\songt\\\\PycharmProjects\\\\PV2EV_Dash\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport date_utils from './date_utils';\nimport { $, createSVG, animateSVG } from './svg_utils';\n\nvar Bar = /*#__PURE__*/function () {\n  function Bar(gantt, task) {\n    _classCallCheck(this, Bar);\n\n    this.set_defaults(gantt, task);\n    this.prepare();\n    this.draw();\n    this.bind();\n  }\n\n  _createClass(Bar, [{\n    key: \"set_defaults\",\n    value: function set_defaults(gantt, task) {\n      this.action_completed = false;\n      this.gantt = gantt;\n      this.task = task;\n    }\n  }, {\n    key: \"prepare\",\n    value: function prepare() {\n      this.prepare_values();\n      this.prepare_helpers();\n    }\n  }, {\n    key: \"prepare_values\",\n    value: function prepare_values() {\n      this.invalid = this.task.invalid;\n      this.height = this.gantt.options.bar_height;\n      this.x = this.compute_x();\n      this.y = this.compute_y();\n      this.corner_radius = this.gantt.options.bar_corner_radius;\n      this.duration = date_utils.diff(this.task._end, this.task._start, 'hour') / this.gantt.options.step;\n      this.width = this.gantt.options.column_width * this.duration;\n      this.progress_width = this.gantt.options.column_width * this.duration * (this.task.progress / 100) || 0;\n      this.group = createSVG('g', {\n        class: 'bar-wrapper ' + (this.task.custom_class || ''),\n        'data-id': this.task.id\n      });\n      this.bar_group = createSVG('g', {\n        class: 'bar-group',\n        append_to: this.group\n      });\n      this.handle_group = createSVG('g', {\n        class: 'handle-group',\n        append_to: this.group\n      });\n    }\n  }, {\n    key: \"prepare_helpers\",\n    value: function prepare_helpers() {\n      SVGElement.prototype.getX = function () {\n        return +this.getAttribute('x');\n      };\n\n      SVGElement.prototype.getY = function () {\n        return +this.getAttribute('y');\n      };\n\n      SVGElement.prototype.getWidth = function () {\n        return +this.getAttribute('width');\n      };\n\n      SVGElement.prototype.getHeight = function () {\n        return +this.getAttribute('height');\n      };\n\n      SVGElement.prototype.getEndX = function () {\n        return this.getX() + this.getWidth();\n      };\n    }\n  }, {\n    key: \"draw\",\n    value: function draw() {\n      this.draw_bar();\n      this.draw_progress_bar();\n      this.draw_label();\n      this.draw_resize_handles();\n    }\n  }, {\n    key: \"draw_bar\",\n    value: function draw_bar() {\n      this.$bar = createSVG('rect', {\n        x: this.x,\n        y: this.y,\n        width: this.width,\n        height: this.height,\n        rx: this.corner_radius,\n        ry: this.corner_radius,\n        class: 'bar',\n        append_to: this.bar_group\n      });\n      animateSVG(this.$bar, 'width', 0, this.width);\n\n      if (this.invalid) {\n        this.$bar.classList.add('bar-invalid');\n      }\n    }\n  }, {\n    key: \"draw_progress_bar\",\n    value: function draw_progress_bar() {\n      if (this.invalid) return;\n      this.$bar_progress = createSVG('rect', {\n        x: this.x,\n        y: this.y,\n        width: this.progress_width,\n        height: this.height,\n        rx: this.corner_radius,\n        ry: this.corner_radius,\n        class: 'bar-progress',\n        append_to: this.bar_group\n      });\n      animateSVG(this.$bar_progress, 'width', 0, this.progress_width);\n    }\n  }, {\n    key: \"draw_label\",\n    value: function draw_label() {\n      var _this = this;\n\n      createSVG('text', {\n        x: this.x + this.width / 2,\n        y: this.y + this.height / 2,\n        innerHTML: this.task.name,\n        class: 'bar-label',\n        append_to: this.bar_group\n      }); // labels get BBox in the next tick\n\n      requestAnimationFrame(function () {\n        return _this.update_label_position();\n      });\n    }\n  }, {\n    key: \"draw_resize_handles\",\n    value: function draw_resize_handles() {\n      if (this.invalid) return;\n      var bar = this.$bar;\n      var handle_width = 8;\n      createSVG('rect', {\n        x: bar.getX() + bar.getWidth() - 9,\n        y: bar.getY() + 1,\n        width: handle_width,\n        height: this.height - 2,\n        rx: this.corner_radius,\n        ry: this.corner_radius,\n        class: 'handle right',\n        append_to: this.handle_group\n      });\n      createSVG('rect', {\n        x: bar.getX() + 1,\n        y: bar.getY() + 1,\n        width: handle_width,\n        height: this.height - 2,\n        rx: this.corner_radius,\n        ry: this.corner_radius,\n        class: 'handle left',\n        append_to: this.handle_group\n      });\n\n      if (this.task.progress && this.task.progress < 100) {\n        this.$handle_progress = createSVG('polygon', {\n          points: this.get_progress_polygon_points().join(','),\n          class: 'handle progress',\n          append_to: this.handle_group\n        });\n      }\n    }\n  }, {\n    key: \"get_progress_polygon_points\",\n    value: function get_progress_polygon_points() {\n      var bar_progress = this.$bar_progress;\n      return [bar_progress.getEndX() - 5, bar_progress.getY() + bar_progress.getHeight(), bar_progress.getEndX() + 5, bar_progress.getY() + bar_progress.getHeight(), bar_progress.getEndX(), bar_progress.getY() + bar_progress.getHeight() - 8.66];\n    }\n  }, {\n    key: \"bind\",\n    value: function bind() {\n      if (this.invalid) return;\n      this.setup_click_event();\n    }\n  }, {\n    key: \"setup_click_event\",\n    value: function setup_click_event() {\n      var _this2 = this;\n\n      $.on(this.group, 'focus ' + this.gantt.options.popup_trigger, function (e) {\n        if (_this2.action_completed) {\n          // just finished a move action, wait for a few seconds\n          return;\n        }\n\n        if (e.type === 'click') {\n          _this2.gantt.trigger_event('click', [_this2.task]);\n        }\n\n        _this2.gantt.unselect_all();\n\n        _this2.group.classList.toggle('active');\n\n        _this2.show_popup();\n      });\n    }\n  }, {\n    key: \"show_popup\",\n    value: function show_popup() {\n      if (this.gantt.bar_being_dragged) return;\n      var start_date = date_utils.format(this.task._start, 'MMM D');\n      var end_date = date_utils.format(date_utils.add(this.task._end, -1, 'second'), 'MMM D');\n      var subtitle = start_date + ' - ' + end_date;\n      this.gantt.show_popup({\n        target_element: this.$bar,\n        title: this.task.name,\n        subtitle: subtitle,\n        task: this.task\n      });\n    }\n  }, {\n    key: \"update_bar_position\",\n    value: function update_bar_position(_ref) {\n      var _this3 = this;\n\n      var _ref$x = _ref.x,\n          x = _ref$x === void 0 ? null : _ref$x,\n          _ref$width = _ref.width,\n          width = _ref$width === void 0 ? null : _ref$width;\n      var bar = this.$bar;\n\n      if (x) {\n        // get all x values of parent task\n        var xs = this.task.dependencies.map(function (dep) {\n          return _this3.gantt.get_bar(dep).$bar.getX();\n        }); // child task must not go before parent\n\n        var valid_x = xs.reduce(function (prev, curr) {\n          return x >= curr;\n        }, x);\n\n        if (!valid_x) {\n          width = null;\n          return;\n        }\n\n        this.update_attr(bar, 'x', x);\n      }\n\n      if (width && width >= this.gantt.options.column_width) {\n        this.update_attr(bar, 'width', width);\n      }\n\n      this.update_label_position();\n      this.update_handle_position();\n      this.update_progressbar_position();\n      this.update_arrow_position();\n    }\n  }, {\n    key: \"date_changed\",\n    value: function date_changed() {\n      var changed = false;\n\n      var _this$compute_start_e = this.compute_start_end_date(),\n          new_start_date = _this$compute_start_e.new_start_date,\n          new_end_date = _this$compute_start_e.new_end_date;\n\n      if (Number(this.task._start) !== Number(new_start_date)) {\n        changed = true;\n        this.task._start = new_start_date;\n      }\n\n      if (Number(this.task._end) !== Number(new_end_date)) {\n        changed = true;\n        this.task._end = new_end_date;\n      }\n\n      if (!changed) return;\n      this.gantt.trigger_event('date_change', [this.task, new_start_date, date_utils.add(new_end_date, -1, 'second')]);\n    }\n  }, {\n    key: \"progress_changed\",\n    value: function progress_changed() {\n      var new_progress = this.compute_progress();\n      this.task.progress = new_progress;\n      this.gantt.trigger_event('progress_change', [this.task, new_progress]);\n    }\n  }, {\n    key: \"set_action_completed\",\n    value: function set_action_completed() {\n      var _this4 = this;\n\n      this.action_completed = true;\n      setTimeout(function () {\n        return _this4.action_completed = false;\n      }, 1000);\n    }\n  }, {\n    key: \"compute_start_end_date\",\n    value: function compute_start_end_date() {\n      var bar = this.$bar;\n      var x_in_units = bar.getX() / this.gantt.options.column_width;\n      var new_start_date = date_utils.add(this.gantt.gantt_start, x_in_units * this.gantt.options.step, 'hour');\n      var width_in_units = bar.getWidth() / this.gantt.options.column_width;\n      var new_end_date = date_utils.add(new_start_date, width_in_units * this.gantt.options.step, 'hour');\n      return {\n        new_start_date,\n        new_end_date\n      };\n    }\n  }, {\n    key: \"compute_progress\",\n    value: function compute_progress() {\n      var progress = this.$bar_progress.getWidth() / this.$bar.getWidth() * 100;\n      return parseInt(progress, 10);\n    }\n  }, {\n    key: \"compute_x\",\n    value: function compute_x() {\n      var _this$gantt$options = this.gantt.options,\n          step = _this$gantt$options.step,\n          column_width = _this$gantt$options.column_width;\n      var task_start = this.task._start;\n      var gantt_start = this.gantt.gantt_start;\n      var diff = date_utils.diff(task_start, gantt_start, 'hour');\n      var x = diff / step * column_width;\n\n      if (this.gantt.view_is('Month')) {\n        var _diff = date_utils.diff(task_start, gantt_start, 'day');\n\n        x = _diff * column_width / 30;\n      }\n\n      return x;\n    }\n  }, {\n    key: \"compute_y\",\n    value: function compute_y() {\n      return this.gantt.options.header_height + this.gantt.options.padding + this.task._index * (this.height + this.gantt.options.padding);\n    }\n  }, {\n    key: \"get_snap_position\",\n    value: function get_snap_position(dx) {\n      var odx = dx,\n          rem,\n          position;\n\n      if (this.gantt.view_is('Week')) {\n        rem = dx % (this.gantt.options.column_width / 7);\n        position = odx - rem + (rem < this.gantt.options.column_width / 14 ? 0 : this.gantt.options.column_width / 7);\n      } else if (this.gantt.view_is('Month')) {\n        rem = dx % (this.gantt.options.column_width / 30);\n        position = odx - rem + (rem < this.gantt.options.column_width / 60 ? 0 : this.gantt.options.column_width / 30);\n      } else {\n        rem = dx % this.gantt.options.column_width;\n        position = odx - rem + (rem < this.gantt.options.column_width / 2 ? 0 : this.gantt.options.column_width);\n      }\n\n      return position;\n    }\n  }, {\n    key: \"update_attr\",\n    value: function update_attr(element, attr, value) {\n      value = +value;\n\n      if (!isNaN(value)) {\n        element.setAttribute(attr, value);\n      }\n\n      return element;\n    }\n  }, {\n    key: \"update_progressbar_position\",\n    value: function update_progressbar_position() {\n      this.$bar_progress.setAttribute('x', this.$bar.getX());\n      this.$bar_progress.setAttribute('width', this.$bar.getWidth() * (this.task.progress / 100));\n    }\n  }, {\n    key: \"update_label_position\",\n    value: function update_label_position() {\n      var bar = this.$bar,\n          label = this.group.querySelector('.bar-label');\n\n      if (label.getBBox().width > bar.getWidth()) {\n        label.classList.add('big');\n        label.setAttribute('x', bar.getX() + bar.getWidth() + 5);\n      } else {\n        label.classList.remove('big');\n        label.setAttribute('x', bar.getX() + bar.getWidth() / 2);\n      }\n    }\n  }, {\n    key: \"update_handle_position\",\n    value: function update_handle_position() {\n      var bar = this.$bar;\n      this.handle_group.querySelector('.handle.left').setAttribute('x', bar.getX() + 1);\n      this.handle_group.querySelector('.handle.right').setAttribute('x', bar.getEndX() - 9);\n      var handle = this.group.querySelector('.handle.progress');\n      handle && handle.setAttribute('points', this.get_progress_polygon_points());\n    }\n  }, {\n    key: \"update_arrow_position\",\n    value: function update_arrow_position() {\n      this.arrows = this.arrows || [];\n\n      var _iterator = _createForOfIteratorHelper(this.arrows),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var arrow = _step.value;\n          arrow.update();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }]);\n\n  return Bar;\n}();\n\nexport { Bar as default };\n\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}","map":{"version":3,"sources":["C:/Users/songt/PycharmProjects/PV2EV_Dash/node_modules/frappe-gantt/src/bar.js"],"names":["date_utils","$","createSVG","animateSVG","Bar","gantt","task","set_defaults","prepare","draw","bind","action_completed","prepare_values","prepare_helpers","invalid","height","options","bar_height","x","compute_x","y","compute_y","corner_radius","bar_corner_radius","duration","diff","_end","_start","step","width","column_width","progress_width","progress","group","class","custom_class","id","bar_group","append_to","handle_group","SVGElement","prototype","getX","getAttribute","getY","getWidth","getHeight","getEndX","draw_bar","draw_progress_bar","draw_label","draw_resize_handles","$bar","rx","ry","classList","add","$bar_progress","innerHTML","name","requestAnimationFrame","update_label_position","bar","handle_width","$handle_progress","points","get_progress_polygon_points","join","bar_progress","setup_click_event","on","popup_trigger","e","type","trigger_event","unselect_all","toggle","show_popup","bar_being_dragged","start_date","format","end_date","subtitle","target_element","title","xs","dependencies","map","dep","get_bar","valid_x","reduce","prev","curr","update_attr","update_handle_position","update_progressbar_position","update_arrow_position","changed","compute_start_end_date","new_start_date","new_end_date","Number","new_progress","compute_progress","setTimeout","x_in_units","gantt_start","width_in_units","parseInt","task_start","view_is","header_height","padding","_index","dx","odx","rem","position","element","attr","value","isNaN","setAttribute","label","querySelector","getBBox","remove","handle","arrows","arrow","update","isFunction","functionToCheck","getType","toString","call"],"mappings":"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","sourcesContent":["import date_utils from './date_utils';\nimport { $, createSVG, animateSVG } from './svg_utils';\n\nexport default class Bar {\n    constructor(gantt, task) {\n        this.set_defaults(gantt, task);\n        this.prepare();\n        this.draw();\n        this.bind();\n    }\n\n    set_defaults(gantt, task) {\n        this.action_completed = false;\n        this.gantt = gantt;\n        this.task = task;\n    }\n\n    prepare() {\n        this.prepare_values();\n        this.prepare_helpers();\n    }\n\n    prepare_values() {\n        this.invalid = this.task.invalid;\n        this.height = this.gantt.options.bar_height;\n        this.x = this.compute_x();\n        this.y = this.compute_y();\n        this.corner_radius = this.gantt.options.bar_corner_radius;\n        this.duration =\n            date_utils.diff(this.task._end, this.task._start, 'hour') /\n            this.gantt.options.step;\n        this.width = this.gantt.options.column_width * this.duration;\n        this.progress_width =\n            this.gantt.options.column_width *\n                this.duration *\n                (this.task.progress / 100) || 0;\n        this.group = createSVG('g', {\n            class: 'bar-wrapper ' + (this.task.custom_class || ''),\n            'data-id': this.task.id\n        });\n        this.bar_group = createSVG('g', {\n            class: 'bar-group',\n            append_to: this.group\n        });\n        this.handle_group = createSVG('g', {\n            class: 'handle-group',\n            append_to: this.group\n        });\n    }\n\n    prepare_helpers() {\n        SVGElement.prototype.getX = function() {\n            return +this.getAttribute('x');\n        };\n        SVGElement.prototype.getY = function() {\n            return +this.getAttribute('y');\n        };\n        SVGElement.prototype.getWidth = function() {\n            return +this.getAttribute('width');\n        };\n        SVGElement.prototype.getHeight = function() {\n            return +this.getAttribute('height');\n        };\n        SVGElement.prototype.getEndX = function() {\n            return this.getX() + this.getWidth();\n        };\n    }\n\n    draw() {\n        this.draw_bar();\n        this.draw_progress_bar();\n        this.draw_label();\n        this.draw_resize_handles();\n    }\n\n    draw_bar() {\n        this.$bar = createSVG('rect', {\n            x: this.x,\n            y: this.y,\n            width: this.width,\n            height: this.height,\n            rx: this.corner_radius,\n            ry: this.corner_radius,\n            class: 'bar',\n            append_to: this.bar_group\n        });\n\n        animateSVG(this.$bar, 'width', 0, this.width);\n\n        if (this.invalid) {\n            this.$bar.classList.add('bar-invalid');\n        }\n    }\n\n    draw_progress_bar() {\n        if (this.invalid) return;\n        this.$bar_progress = createSVG('rect', {\n            x: this.x,\n            y: this.y,\n            width: this.progress_width,\n            height: this.height,\n            rx: this.corner_radius,\n            ry: this.corner_radius,\n            class: 'bar-progress',\n            append_to: this.bar_group\n        });\n\n        animateSVG(this.$bar_progress, 'width', 0, this.progress_width);\n    }\n\n    draw_label() {\n        createSVG('text', {\n            x: this.x + this.width / 2,\n            y: this.y + this.height / 2,\n            innerHTML: this.task.name,\n            class: 'bar-label',\n            append_to: this.bar_group\n        });\n        // labels get BBox in the next tick\n        requestAnimationFrame(() => this.update_label_position());\n    }\n\n    draw_resize_handles() {\n        if (this.invalid) return;\n\n        const bar = this.$bar;\n        const handle_width = 8;\n\n        createSVG('rect', {\n            x: bar.getX() + bar.getWidth() - 9,\n            y: bar.getY() + 1,\n            width: handle_width,\n            height: this.height - 2,\n            rx: this.corner_radius,\n            ry: this.corner_radius,\n            class: 'handle right',\n            append_to: this.handle_group\n        });\n\n        createSVG('rect', {\n            x: bar.getX() + 1,\n            y: bar.getY() + 1,\n            width: handle_width,\n            height: this.height - 2,\n            rx: this.corner_radius,\n            ry: this.corner_radius,\n            class: 'handle left',\n            append_to: this.handle_group\n        });\n\n        if (this.task.progress && this.task.progress < 100) {\n            this.$handle_progress = createSVG('polygon', {\n                points: this.get_progress_polygon_points().join(','),\n                class: 'handle progress',\n                append_to: this.handle_group\n            });\n        }\n    }\n\n    get_progress_polygon_points() {\n        const bar_progress = this.$bar_progress;\n        return [\n            bar_progress.getEndX() - 5,\n            bar_progress.getY() + bar_progress.getHeight(),\n            bar_progress.getEndX() + 5,\n            bar_progress.getY() + bar_progress.getHeight(),\n            bar_progress.getEndX(),\n            bar_progress.getY() + bar_progress.getHeight() - 8.66\n        ];\n    }\n\n    bind() {\n        if (this.invalid) return;\n        this.setup_click_event();\n    }\n\n    setup_click_event() {\n        $.on(this.group, 'focus ' + this.gantt.options.popup_trigger, e => {\n            if (this.action_completed) {\n                // just finished a move action, wait for a few seconds\n                return;\n            }\n\n            if (e.type === 'click') {\n                this.gantt.trigger_event('click', [this.task]);\n            }\n\n            this.gantt.unselect_all();\n            this.group.classList.toggle('active');\n\n            this.show_popup();\n        });\n    }\n\n    show_popup() {\n        if (this.gantt.bar_being_dragged) return;\n\n        const start_date = date_utils.format(this.task._start, 'MMM D');\n        const end_date = date_utils.format(\n            date_utils.add(this.task._end, -1, 'second'),\n            'MMM D'\n        );\n        const subtitle = start_date + ' - ' + end_date;\n\n        this.gantt.show_popup({\n            target_element: this.$bar,\n            title: this.task.name,\n            subtitle: subtitle,\n            task: this.task\n        });\n    }\n\n    update_bar_position({ x = null, width = null }) {\n        const bar = this.$bar;\n        if (x) {\n            // get all x values of parent task\n            const xs = this.task.dependencies.map(dep => {\n                return this.gantt.get_bar(dep).$bar.getX();\n            });\n            // child task must not go before parent\n            const valid_x = xs.reduce((prev, curr) => {\n                return x >= curr;\n            }, x);\n            if (!valid_x) {\n                width = null;\n                return;\n            }\n            this.update_attr(bar, 'x', x);\n        }\n        if (width && width >= this.gantt.options.column_width) {\n            this.update_attr(bar, 'width', width);\n        }\n        this.update_label_position();\n        this.update_handle_position();\n        this.update_progressbar_position();\n        this.update_arrow_position();\n    }\n\n    date_changed() {\n        let changed = false;\n        const { new_start_date, new_end_date } = this.compute_start_end_date();\n\n        if (Number(this.task._start) !== Number(new_start_date)) {\n            changed = true;\n            this.task._start = new_start_date;\n        }\n\n        if (Number(this.task._end) !== Number(new_end_date)) {\n            changed = true;\n            this.task._end = new_end_date;\n        }\n\n        if (!changed) return;\n\n        this.gantt.trigger_event('date_change', [\n            this.task,\n            new_start_date,\n            date_utils.add(new_end_date, -1, 'second')\n        ]);\n    }\n\n    progress_changed() {\n        const new_progress = this.compute_progress();\n        this.task.progress = new_progress;\n        this.gantt.trigger_event('progress_change', [this.task, new_progress]);\n    }\n\n    set_action_completed() {\n        this.action_completed = true;\n        setTimeout(() => (this.action_completed = false), 1000);\n    }\n\n    compute_start_end_date() {\n        const bar = this.$bar;\n        const x_in_units = bar.getX() / this.gantt.options.column_width;\n        const new_start_date = date_utils.add(\n            this.gantt.gantt_start,\n            x_in_units * this.gantt.options.step,\n            'hour'\n        );\n        const width_in_units = bar.getWidth() / this.gantt.options.column_width;\n        const new_end_date = date_utils.add(\n            new_start_date,\n            width_in_units * this.gantt.options.step,\n            'hour'\n        );\n\n        return { new_start_date, new_end_date };\n    }\n\n    compute_progress() {\n        const progress =\n            this.$bar_progress.getWidth() / this.$bar.getWidth() * 100;\n        return parseInt(progress, 10);\n    }\n\n    compute_x() {\n        const { step, column_width } = this.gantt.options;\n        const task_start = this.task._start;\n        const gantt_start = this.gantt.gantt_start;\n\n        const diff = date_utils.diff(task_start, gantt_start, 'hour');\n        let x = diff / step * column_width;\n\n        if (this.gantt.view_is('Month')) {\n            const diff = date_utils.diff(task_start, gantt_start, 'day');\n            x = diff * column_width / 30;\n        }\n        return x;\n    }\n\n    compute_y() {\n        return (\n            this.gantt.options.header_height +\n            this.gantt.options.padding +\n            this.task._index * (this.height + this.gantt.options.padding)\n        );\n    }\n\n    get_snap_position(dx) {\n        let odx = dx,\n            rem,\n            position;\n\n        if (this.gantt.view_is('Week')) {\n            rem = dx % (this.gantt.options.column_width / 7);\n            position =\n                odx -\n                rem +\n                (rem < this.gantt.options.column_width / 14\n                    ? 0\n                    : this.gantt.options.column_width / 7);\n        } else if (this.gantt.view_is('Month')) {\n            rem = dx % (this.gantt.options.column_width / 30);\n            position =\n                odx -\n                rem +\n                (rem < this.gantt.options.column_width / 60\n                    ? 0\n                    : this.gantt.options.column_width / 30);\n        } else {\n            rem = dx % this.gantt.options.column_width;\n            position =\n                odx -\n                rem +\n                (rem < this.gantt.options.column_width / 2\n                    ? 0\n                    : this.gantt.options.column_width);\n        }\n        return position;\n    }\n\n    update_attr(element, attr, value) {\n        value = +value;\n        if (!isNaN(value)) {\n            element.setAttribute(attr, value);\n        }\n        return element;\n    }\n\n    update_progressbar_position() {\n        this.$bar_progress.setAttribute('x', this.$bar.getX());\n        this.$bar_progress.setAttribute(\n            'width',\n            this.$bar.getWidth() * (this.task.progress / 100)\n        );\n    }\n\n    update_label_position() {\n        const bar = this.$bar,\n            label = this.group.querySelector('.bar-label');\n\n        if (label.getBBox().width > bar.getWidth()) {\n            label.classList.add('big');\n            label.setAttribute('x', bar.getX() + bar.getWidth() + 5);\n        } else {\n            label.classList.remove('big');\n            label.setAttribute('x', bar.getX() + bar.getWidth() / 2);\n        }\n    }\n\n    update_handle_position() {\n        const bar = this.$bar;\n        this.handle_group\n            .querySelector('.handle.left')\n            .setAttribute('x', bar.getX() + 1);\n        this.handle_group\n            .querySelector('.handle.right')\n            .setAttribute('x', bar.getEndX() - 9);\n        const handle = this.group.querySelector('.handle.progress');\n        handle &&\n            handle.setAttribute('points', this.get_progress_polygon_points());\n    }\n\n    update_arrow_position() {\n        this.arrows = this.arrows || [];\n        for (let arrow of this.arrows) {\n            arrow.update();\n        }\n    }\n}\n\nfunction isFunction(functionToCheck) {\n    var getType = {};\n    return (\n        functionToCheck &&\n        getType.toString.call(functionToCheck) === '[object Function]'\n    );\n}\n"]},"metadata":{},"sourceType":"module"}